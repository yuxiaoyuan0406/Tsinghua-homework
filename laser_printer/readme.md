##激光雕刻装置·一些说明——秦智

- 有三个完整的版本，每个版本包含客户端（单片机，在mbed平台上编译），和服务器代码
- 采用的网络通信为TCP协议，客户端采用串口接esp8266来进行wifi通信，在助教提供的esp8266类基础上改为TCP协议，并加入数据存储。服务器端采用python编写TCP服务器，使用了socketserver库
- 服务器通过PIL的Image库可以读取几乎所有常见图片格式的图片，利用内置函数转化为灰度图或黑白图。

#### 版本1

流程为，先运行服务器，再开启激光打印机，服务器端在取得客户端连接后，要求输入图片地址（或默认位置），服务器端读取图片，将图片转为100$\times$100的黑白图，数据一部分一部分发给单片机，单片机同时进行画图。

#### 版本2

流程为，客户端将图片转为100$\times$100的黑白图，将数据记录在laser_pic.txt中，将其复制到mbed的客户端代码的ssdata[]中，编译后烧进激光雕刻机开启即可画图。

#### 版本3

流程为，先运行服务器，再开启激光打印机，服务器端在取得客户端连接后，要求输入图片地址（或默认位置），服务器端读取图片，将图片转为N$\times$N（可设置）的灰度图（客户端对大小限制不大，不超出边界即可），每次发若干点的数据给单片机（数据为若干个（x,y,value）连接构成），单片机收到数据后，解析成若干点的数据(函数dealdata()，并得到数据点个数)，然后单片机画出这若干个点。当一个图全画完后，服务器和单片机进入复位等待状态，等待下一个图片命令。

注：

1. 如果只有中心有点，单片机会直接画中间的数据，对于value=0的空点，激光头不会过去，所以用这种方式，不管位图还是矢量图都可以，取决于图片数据，打矢量图时效率不会浪费。事实上，效率取决于激光功率（现在是500mW，聚焦后将木板一个点打黑至少要0.8-1s左右），效果取决于单片机x,y的分辨率（与矢量图还是位图无关）和能接受的打印时间，分辨率越高，时间越长，所以提高功率对两方面都有提升
2. esp8266的TCP服务器是建立在NodeMcu固件的Lua脚本语言上的，官网为http://www.nodemcu.com/index_cn.html，文档在http://nodemcu.readthedocs.io/en/master/（英文），https://github.com/nodemcu/nodemcu-firmware/wiki/nodemcu_api_cn（中文）
3. 可以考虑将8266的TCP设置为断开重连，或者采用mqtt协议可能更稳定。
4. 服务器端嵌入整个系统时可以考虑threading库多线程处理，也可以直接作为独立模块单独运行
5. 单片机与激光硬件接线参考 激光扫描mbed电路板V2.pdf，其中激光头用12V电压，用电子开关控制，客户端程序的main.cpp中有详细说明。

